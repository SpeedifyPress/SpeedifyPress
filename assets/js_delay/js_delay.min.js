(function(){class JsDelayer{constructor(e="",t="",s=3,r=!1,i=!1){this.loadFirst=new Set(this.parseList(e)),this.loadLast=new Set(this.parseList(t)),this.timeout=1e3*s,this.debug=i,this.callback=r,this.callback_run=!1,this.hasTriggeredEvents=!1,this._loading=!1,this.savedClicks=new Set,this.savedMouseovers=new Set,this.interactionEvents=["click","mouseover","keydown","touchstart","touchmove","wheel"],this.init()}parseList(e){const t=e.split("\n").filter((e=>""!==e.trim()));return this.debug&&console.log("Parsed list:",t),t}init(){this.debug&&(console.log("JsDelayer initialized."),console.log("Load first scripts:",Array.from(this.loadFirst)),console.log("Load last scripts:",Array.from(this.loadLast)),console.log("Timeout set to:",this.timeout/1e3,"seconds")),this.bound_start=this.startLoading.bind(this),this.boundTrackUserInteractions=this.trackUserInteractions.bind(this),this.interactionEvents.forEach((e=>{window.addEventListener(e,this.bound_start,{passive:!0})})),window.addEventListener("click",this.boundTrackUserInteractions,{passive:!0}),window.addEventListener("mouseover",this.boundTrackUserInteractions,{passive:!0}),setTimeout(this.bound_start,this.timeout)}ensureTemplatesRestored(){if(!!document.querySelector(".unused-invisible > template")){this.debug&&console.log("Ensuring templates are restored before loading scripts...");try{if("function"==typeof window.restoreTemplateContentAndImages)return void window.restoreTemplateContentAndImages();document.querySelectorAll(".unused-invisible").forEach((e=>{const t=e.children[0];if(t&&"TEMPLATE"===t.tagName){e.style.contentVisibility="",e.style.containIntrinsicSize="";const s=t.content.cloneNode(!0);e.replaceChild(s,t)}}))}catch(e){this.debug&&console.error("Error while restoring templates before JS load:",e)}}}trackUserInteractions(e){void 0!==e&&(this.debug&&console.log("Tracking user interaction:",e),"mouseover"==e.type&&this.savedMouseovers.add(e),"click"==e.type&&this.savedClicks.add(e))}startLoading(e){if(this._loading)return;if(this.debug&&console.log("Starting script loading process...",e),void 0!==e&&"mouseover"==e.type&&0==matchMedia("(hover: hover)").matches)return;"complete"===document.readyState||"interactive"===document.readyState?(this.ensureTemplatesRestored(),this._loading=!0,this.interactionEvents.forEach((e=>{window.removeEventListener(e,this.bound_start,{passive:!0})})),this.preloadScripts(),this.loadScripts()):this._pendingDomReady||(this._pendingDomReady=!0,this.debug&&console.log("DOM not ready yet; waiting for DOMContentLoaded before loading scripts."),document.addEventListener("DOMContentLoaded",this.bound_start,{once:!0}))}preloadScripts(){const e=this.getScriptOrder();0!=e.length&&e.forEach((e=>{if("LINK"===e.tagName){const t=e.getAttribute("data-href");if(!t)return;this.debug&&console.log("Restoring modulepreload:",t),e.setAttribute("href",t),e.removeAttribute("data-href"),e.hasAttribute("data-rel")&&(e.setAttribute("rel",e.getAttribute("data-rel")),e.removeAttribute("data-rel"))}if("SCRIPT"===e.tagName){const t="module"===(e.getAttribute("type")||"").toLowerCase(),s=e.getAttribute("data-src");if(!s||"null"===s||"undefined"===s)return;const r=document.createElement("link");t?(r.rel="modulepreload",r.href=s,["crossorigin","integrity","referrerpolicy"].forEach((t=>{e.hasAttribute(t)&&r.setAttribute(t,e.getAttribute(t))})),this.debug&&console.log("Modulepreloading:",s)):(r.rel="preload",r.as="script",r.href=s,this.debug&&console.log("Preloading scriptz:",s)),document.head.appendChild(r)}}))}loadScripts(){const e=this.getScriptOrder().filter((e=>"SCRIPT"===e.tagName));0!=e.length&&this.loadScriptsSequentially(e)}getScriptOrder(){const e=[...document.querySelectorAll("script[data-src],link[data-rel='modulepreload']")],t=e.filter((e=>{const t=e.getAttribute("data-src")||e.getAttribute("data-href");return!!t&&Array.from(this.loadFirst).some((e=>t.includes(e)))})),s=e.filter((e=>{const t=e.getAttribute("data-src")||e.getAttribute("data-href");return!!t&&Array.from(this.loadLast).some((e=>t.includes(e)))})),r=e.filter((e=>{const t=e.getAttribute("data-src")||e.getAttribute("data-href");return!!t&&(!Array.from(this.loadFirst).some((e=>t.includes(e)))&&!Array.from(this.loadLast).some((e=>t.includes(e))))})),i=[...t,...r,...s];return this.debug&&(console.log("First scripts",t,this.loadFirst),console.log("Last scripts",s,this.loadLast),console.log("Scripts to load in order:",i.map((e=>e.getAttribute("data-src")||e.getAttribute("data-href"))))),i||0}loadScriptsSequentially(e){const t=s=>{if(s>=e.length)return document.dispatchEvent(new Event("delayedJSLoaded")),this.debug&&console.log("All scripts loaded. Triggering events and replaying saved events..."),void this.triggerEvents().then((()=>{if(setTimeout((()=>{window.removeEventListener("mouseover",this.boundTrackUserInteractions,{passive:!0}),window.removeEventListener("click",this.boundTrackUserInteractions,{passive:!0}),this.replaySavedEvents()}),100),this.callback&&!1===this.callback_run){const e=new Function(this.callback);"function"==typeof e&&(e(),this.callback_run=!0)}var e=this.getScriptOrder().length;this.debug&&console.log("Rerunning script loader...",e),e>0&&this.bound_start()}));const r=e[s];if(!r||"SCRIPT"!==r.tagName)return void t(s+1);const i=r.getAttribute("data-src");if(!i||"null"===i||"undefined"===i)return this.debug&&console.warn("Skipping script with invalid data-src:",r,i),void t(s+1);r.onload=()=>t(s+1),r.onerror=()=>t(s+1),r.src=i,r.removeAttribute("data-src")};t(0)}triggerEvents(){return new Promise((e=>{if(this.hasTriggeredEvents)return this.debug&&console.log("triggerEvents already executed. Skipping..."),void e();this.hasTriggeredEvents=!0;if(["ready","DOMContentLoaded","load"].forEach((e=>{const t=new Event(e);this.debug&&console.log("Triggering event:",e),window.dispatchEvent(t)})),window.jQuery&&"function"==typeof jQuery(document).get){const e=jQuery._data(jQuery(document).get(0),"events");e&&e.ready&&e.ready.forEach((({handler:e})=>{this.debug&&console.log("Triggering jQuery ready handler:",e),e(document)})),e&&e.load&&e.load.forEach((({handler:e})=>{this.debug&&console.log("Triggering jQuery load handler:",e),e(document)}))}e()}))}replaySavedEvents(){this.debug&&(console.log("Replaying clicks",this.savedClicks),console.log("Replaying mouseovers",this.savedMouseovers)),this.savedClicks.forEach((e=>{this.savedClicks.delete(e);const t=e.target;if(this.debug&&console.log("Replaying click event for target:",t),t){const s=new MouseEvent("click",{view:e.view,bubbles:!0,cancelable:!0});t.dispatchEvent(s)}})),this.savedMouseovers.forEach((e=>{this.savedMouseovers.delete(e);const t=e.target;if(this.debug&&console.log("Replaying mouseover event for target:",t),t){const s=new MouseEvent("mouseover",{view:e.view,bubbles:!0,cancelable:!0});t.dispatchEvent(s)}})),this.savedClicks.clear(),this.savedMouseovers.clear()}}!function(){const e=()=>{window.JsDelayer=new JsDelayer(window.speed_js_vars.script_load_first||"",window.speed_js_vars.script_load_last||"",window.speed_js_vars.delay_seconds||6,window.speed_js_vars.delay_callback||!1,!1)};document.querySelectorAll(".spress_do_delay_js").length>0?(window.speed_js_vars.delay_seconds=.1,document.addEventListener("loggedInExceptionsDone",e,{once:!0})):(!0===document.prerendering&&(window.speed_js_vars.delay_seconds=0),e())}();})();