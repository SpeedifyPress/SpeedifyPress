(function(){window.JsDelayer=new class{constructor(e="",t="",s=3,i=!1,o=!1){this.loadFirst=new Set(this.parseList(e)),this.loadLast=new Set(this.parseList(t)),this.timeout=1e3*s,this.debug=o,this.callback=i,this.callback_run=!1,this.hasTriggeredEvents=!1,this.savedClicks=new Set,this.savedMouseovers=new Set,this.interactionEvents=["click","mouseover","keydown","touchstart","touchmove","wheel"],this.init()}parseList(e){const t=e.split("\n").filter((e=>""!==e.trim()));return this.debug&&console.log("Parsed list:",t),t}init(){this.debug&&(console.log("JsDelayer initialized."),console.log("Load first scripts:",Array.from(this.loadFirst)),console.log("Load last scripts:",Array.from(this.loadLast)),console.log("Timeout set to:",this.timeout/1e3,"seconds")),this.bound_start=this.startLoading.bind(this),this.boundTrackUserInteractions=this.trackUserInteractions.bind(this),this.interactionEvents.forEach((e=>{window.addEventListener(e,this.bound_start,{passive:!0})})),window.addEventListener("click",this.boundTrackUserInteractions,{passive:!0}),window.addEventListener("mouseover",this.boundTrackUserInteractions,{passive:!0}),setTimeout(this.bound_start,this.timeout)}trackUserInteractions(e){void 0!==e&&(this.debug&&console.log("Tracking user interaction:",e),"mouseover"==e.type&&this.savedMouseovers.add(e),"click"==e.type&&this.savedClicks.add(e))}startLoading(e){this.debug&&console.log("Starting script loading process...",e),void 0!==e&&"mouseover"==e.type&&0==matchMedia("(hover: hover)").matches||(this.interactionEvents.forEach((e=>{window.removeEventListener(e,this.bound_start,{passive:!0})})),this.preloadScripts(),this.loadScripts())}preloadScripts(){const e=this.getScriptOrder();0!=e.length&&e.forEach((e=>{const t=e.getAttribute("data-src"),s=document.createElement("link");s.rel="preload",s.as="script",s.href=t,this.debug&&console.log("Preloading script:",t),document.head.appendChild(s)}))}loadScripts(){const e=this.getScriptOrder();0!=e.length&&this.loadScriptsSequentially(e)}getScriptOrder(){const e=[...document.querySelectorAll("script[data-src]")],t=e.filter((e=>{const t=e.getAttribute("data-src");return!!t&&Array.from(this.loadFirst).some((e=>t.includes(e)))})),s=e.filter((e=>{const t=e.getAttribute("data-src");return!!t&&Array.from(this.loadLast).some((e=>t.includes(e)))})),i=e.filter((e=>{const t=e.getAttribute("data-src");return!!t&&(!Array.from(this.loadFirst).some((e=>t.includes(e)))&&!Array.from(this.loadLast).some((e=>t.includes(e))))})),o=[...t,...i,...s];return this.debug&&(console.log("First scripts",t,this.loadFirst),console.log("Last scripts",s,this.loadLast),console.log("Scripts to load in order:",o.map((e=>e.getAttribute("data-src"))))),o||0}loadScriptsSequentially(e){const t=s=>{if(s>=e.length)return this.debug&&console.log("All scripts loaded. Triggering events and replaying saved events..."),void this.triggerEvents().then((()=>{if(setTimeout((()=>{window.removeEventListener("mouseover",this.boundTrackUserInteractions,{passive:!0}),window.removeEventListener("click",this.boundTrackUserInteractions,{passive:!0}),this.replaySavedEvents()}),100),this.callback&&!1===this.callback_run){const e=new Function(this.callback);"function"==typeof e&&(e(),this.callback_run=!0)}var e=this.getScriptOrder().length;this.debug&&console.log("Rerunning script loader...",e),e>0&&this.bound_start()}));const i=e[s],o=i.getAttribute("data-src");this.debug&&console.log("Loading script:",o),i.onload=()=>{this.debug&&console.log("Script loaded:",o),t(s+1)},i.onerror=()=>{console.error(`Failed to load script: ${o}`),t(s+1)},i.src=o,i.removeAttribute("data-src")};t(0)}triggerEvents(){return new Promise((e=>{if(this.hasTriggeredEvents)return this.debug&&console.log("triggerEvents already executed. Skipping..."),void e();this.hasTriggeredEvents=!0;if(["ready","DOMContentLoaded","load"].forEach((e=>{const t=new Event(e);this.debug&&console.log("Triggering event:",e),window.dispatchEvent(t)})),window.jQuery){const e=jQuery._data(jQuery(document).get(0),"events");e&&e.ready&&e.ready.forEach((({handler:e})=>{this.debug&&console.log("Triggering jQuery ready handler:",e),e(document)})),e&&e.load&&e.load.forEach((({handler:e})=>{this.debug&&console.log("Triggering jQuery load handler:",e),e(document)}))}e()}))}replaySavedEvents(){this.debug&&(console.log("Replaying clicks",this.savedClicks),console.log("Replaying mouseovers",this.savedMouseovers)),this.savedClicks.forEach((e=>{this.savedClicks.delete(e);const t=e.target;if(this.debug&&console.log("Replaying click event for target:",t),t){const s=new MouseEvent("click",{view:e.view,bubbles:!0,cancelable:!0});t.dispatchEvent(s)}})),this.savedMouseovers.forEach((e=>{this.savedMouseovers.delete(e);const t=e.target;if(this.debug&&console.log("Replaying mouseover event for target:",t),t){const s=new MouseEvent("mouseover",{view:e.view,bubbles:!0,cancelable:!0});t.dispatchEvent(s)}})),this.savedClicks.clear(),this.savedMouseovers.clear()}}(window.speed_js_vars.script_load_first||"",window.speed_js_vars.script_load_last||"",window.speed_js_vars.delay_seconds||6,window.speed_js_vars.delay_callback||!1,!1);})();