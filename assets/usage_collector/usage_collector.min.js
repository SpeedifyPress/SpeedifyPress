(function(){class CSSUsageCollector{constructor(e=!0,t=[]){var s;this.stylesheetsCSS={},this.selectorTexts={},this.selectorTexts.rules={},this.selectorTexts.keyframes={},this.selectorTexts.fonts={},this.currentHost=window.location.host,this.alreadyIncluded=new Set(Array.isArray(null==(s=window.speed_css_vars)?void 0:s.force_includes)?window.speed_css_vars.force_includes:[]),this.logWarnings=e,this.includePatterns=t,this.totalOriginalLength=0,this.totalFilteredLength=0,this.has_collected=!1,this.initialUpdateSent=!1,this.observedClasses=new Set,this.foundFamilies=new Set,this.usedFontRules=new Set,this.usedKeyframes=new Set,this.classObserver=null,this.classUpdateTimer=null,this.debug_selector="",this.debug=!1}collect_when_idle(){void 0!==this.scrollListener&&window.removeEventListener("scroll",this.scrollListener),requestIdleCallback((()=>{0==this.has_collected&&(this.debug&&console.log("Collecting after idle"),this.flash_scroll(),this.collect())}))}async collect(){if(this.debug&&console.log("Start collect"),1==this.has_collected)return void(this.debug&&console.log("Already collected"));"function"==typeof window.restoreTemplateContentAndImages&&window.restoreTemplateContentAndImages();if(!(await this.waitForLcpOrTimeout(1e3)))return this.debug&&console.warn("No LCP entries found; continuing without LCP payload."),this.has_collected=!0,void(this.initialUpdateSent=!0);this.has_collected=!0;var e=document.body.className.split(/\s+/),t=/^(rtl|home|blog|privacy-policy|archive|date|search(-[a-zA-Z0-9-_]+)?|paged|attachment|error404|[a-zA-Z0-9-__]+-template|single(-[a-zA-Z0-9-_]+)?|page(-[a-zA-Z0-9-_]+)?|post-type-archive(-[a-zA-Z0-9-_]+)?|author(-[a-zA-Z0-9-_]+)?|category(-[a-zA-Z0-9-_]+)?|tag(-[a-zA-Z0-9-_]+)?|tax(-[a-zA-Z0-9-_]+)?|term(-[a-zA-Z0-9-_]+)?)$/,s=e.filter((function(e){return t.test(e)}));this.debug&&console.log("Set vars 1");var o=this.getAllInvisibleElements();this.debug&&console.log("Got invisible element"),await this.getLcpImage().then((e=>{var t;const r=[...this.observedClasses].filter((e=>!this.alreadyIncluded.has(e)));this.updateConfig({csrf:window.spdy_csrfToken,force_includes:r,url:document.location.href,post_id:(null==(t=document.body.className.split(" ").find((e=>e.startsWith("postid-")||e.startsWith("page-id-"))))?void 0:t.replace(/(postid-|page-id-)/,""))||null,post_types:s,invisible:{elements:o,viewport:{width:window.innerWidth,height:window.innerHeight}},usedFontRules:[...this.getFontsDownloaded()].join("|"),icon_fonts:this.getIconFontFamilies(),lcp_image:e})}))}updateConfig(e){this.debug&&console.log("Update config with ",e),(async()=>{try{const t=JSON.stringify(e),s=await this.compressAndBase64Encode(t);if(0==s)return void console.warn("Unable to update CSS on this browser");const o=await fetch(window.speed_css_vars.resturl+"speedifypress/update_css",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({compressedData:s})});this.initialUpdateSent||(this.initialUpdateSent=!0);const r=await o.json();console.log("Successfully updated CSS:",r)}catch(t){console.log("Error updating config:",t)}})()}getFontsDownloaded(){if(!1 in performance)return new Set;const e=new Set,t=(e,t)=>{try{return new URL(e,t).href}catch(s){return e}};for(const r of document.styleSheets)try{const s=r.href||document.baseURI;for(const o of r.cssRules)if(o.type===CSSRule.FONT_FACE_RULE){const r=o.style.getPropertyValue("src");if(r){const o=r.match(/url\(([^)]+)\)/g);o&&o.forEach((o=>{const r=o.replace(/url\(|\)|'|"/g,"").trim(),n=t(r,s);e.add(n)}))}}}catch(o){}const s=new Set;return performance.getEntriesByType("resource").forEach((o=>{const r=t(o.name,document.baseURI);e.has(r)&&s.add(o.name)})),s}getIconFontFamilies(){const e=new Set,t=["::before","::after"];return document.querySelectorAll("*").forEach((s=>{t.forEach((t=>{const o=getComputedStyle(s,t);let r=o.getPropertyValue("content")||"";const n=r;var i;if(r=(i=r)&&/^['"].*['"]$/.test(i)?i.slice(1,-1):i,!r||"none"===r||"normal"===r)return;if(!((e="")=>{for(const t of e){const e=t.codePointAt(0);if(e>=57344&&e<=63743||e>=983040&&e<=1048573||e>=1048576&&e<=1114109)return!0}return!1})(r)&&!(e=>/\\[0-9a-fA-F]{1,6}\s?/.test(e||""))(n))return;(o.getPropertyValue("font-family")||"").split(",").map((e=>e.trim().replace(/^['"]|['"]$/g,""))).filter(Boolean).forEach((t=>e.add(t)))}))})),Array.from(e).sort(((e,t)=>e.localeCompare(t)))}async waitForLcpOrTimeout(e=3e3){return new Promise((t=>{var s;let o,r=!1;const n=e=>{r||(r=!0,clearTimeout(i),null==o||o.disconnect(),t(e))};try{"PerformanceObserver"in window&&(null==(s=PerformanceObserver.supportedEntryTypes)?void 0:s.includes("largest-contentful-paint"))&&(o=new PerformanceObserver((e=>{e.getEntries().length&&n(!0)})),o.observe({type:"largest-contentful-paint",buffered:!0}))}catch{}const i=setTimeout((()=>n(!1)),e)}))}getLcpImage(){return new Promise((e=>{if(!("PerformanceObserver"in window)||!PerformanceObserver.supportedEntryTypes||!PerformanceObserver.supportedEntryTypes.includes("largest-contentful-paint"))return void e("");let t="";const s=new PerformanceObserver((o=>{for(const e of o.getEntries()){const s=e.element||null;s&&"IMG"===s.tagName?t=s.currentSrc||s.src||t:s&&"VIDEO"===s.tagName&&s.poster&&(t=s.poster||t),!t&&e.url&&(t=e.url)}t&&(e(t),s.disconnect())}));try{s.observe({type:"largest-contentful-paint",buffered:!0})}catch{try{s.observe({entryTypes:["largest-contentful-paint"]})}catch{return void e("")}}setTimeout((()=>{s.disconnect(),e(t||"")}),500)}))}warn(...e){this.logWarnings&&console.warn(...e)}async compressAndBase64Encode(e){try{const t=(new TextEncoder).encode(e),s=new Blob([t]).stream(),o=s.pipeThrough(new CompressionStream("gzip")).getReader(),r=[];let n,i;for(;({done:n,value:i}=await o.read()),!n;)r.push(i);const l=this.concatUint8Arrays(r);let a="";for(let e=0;e<l.length;e++)a+=String.fromCharCode(l[e]);return btoa(a)}catch(t){return!1}}concatUint8Arrays(e){let t=e.reduce(((e,t)=>e+t.length),0),s=new Uint8Array(t),o=0;for(let r of e)s.set(r,o),o+=r.length;return s}getAllInvisibleElements(e=document.body){const t=[],s="var speed_js_vars =";return function e(o){if(o!==document.body){const e=function(e){let t=0,s=0,o=e;for(;o;)t+=o.offsetLeft-o.scrollLeft+(parseFloat(window.getComputedStyle(o).borderLeftWidth)||0),s+=o.offsetTop-o.scrollTop+(parseFloat(window.getComputedStyle(o).borderTopWidth)||0),o=o.offsetParent;return{x:t,y:s}}(o),r=window.getComputedStyle(o),n=o.offsetWidth>0&&o.offsetHeight>0,i=0,l=1366,a=e.y,c=a+o.offsetHeight;e.x;o.offsetWidth;const d=c<=i||a>=l,u="fixed"===r.position||"sticky"===r.position,h="hidden"===r.visibility||"0"===r.opacity||"none"===r.display||"rect(1px, 1px, 1px, 1px)"===r.clip||"inset(50%)"===r.clipPath||parseFloat(r.width)<=1&&parseFloat(r.height)<=1||"hidden"===r.overflow&&parseFloat(r.height)<=1;if(d&&n&&!h&&!u&&!function(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;if("SCRIPT"===e.tagName&&e.textContent&&e.textContent.includes(s))return!0;if("string"==typeof e.innerHTML&&e.innerHTML.includes(s))return!0;const t=e.getElementsByTagName("script");for(let o of t)if(o.textContent&&o.textContent.includes(s))return!0;return!1}(o))return void t.push({spuid:o.dataset.spuid})}for(let t of o.children)e(t)}(e),t}scheduleClassUpdate(){this.initialUpdateSent&&(clearTimeout(this.classUpdateTimer),this.classUpdateTimer=setTimeout((()=>{try{const e=[...this.observedClasses].filter((e=>!this.alreadyIncluded.has(e)));if(!e.length)return;this.updateConfig({csrf:window.spdy_csrfToken,url:document.location.href,force_includes:[...this.observedClasses],force_includes_only:!0}),e.forEach((e=>this.alreadyIncluded.add(e)))}catch(e){}}),1e3))}_getSortedUniqueClassValue(e){return Array.from(new Set(Array.from(e.classList))).filter(Boolean).sort().join(" ")}start_collect_added_classes(){this.classObserver=new MutationObserver((e=>{let t=!1;for(const s of e)if("attributes"===s.type&&"class"===s.attributeName){const e=s.oldValue?s.oldValue.trim().split(/\s+/).filter(Boolean):[],o=new Set(e),r=Array.from(s.target.classList).filter((e=>!o.has(e)));if(r.length){let e=!1;for(const t of r)this.observedClasses.has(t)||(this.observedClasses.add(t),e=!0);e&&(t=!0)}}t&&this.scheduleClassUpdate()})),this.classObserver.observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["class"],attributeOldValue:!0})}collect_after_scroll(e=!1){e&&(this.debug=!0),this.start_collect_added_classes(),this.scrollListener=()=>{clearTimeout(window.scrollIdleTimeout),window.scrollIdleTimeout=setTimeout((()=>{this.debug&&console.log("Collecting after scroll"),this.collect_when_idle()}),1e3)},setTimeout((()=>{this.debug&&console.log("Collecting after timeout"),window.removeEventListener("scroll",this.scrollListener),this.collect_when_idle()}),5e3),window.addEventListener("scroll",this.scrollListener)}flash_scroll(){const e=window.scrollY;window.scrollTo({top:0,behavior:"instant"}),window.scrollTo({top:document.documentElement.scrollHeight,behavior:"instant"}),window.dispatchEvent(new Event("scroll")),window.scrollTo({top:e,behavior:"instant"})}}!function(){let e=speed_css_vars.generation_res??"desktop";const t=window.innerWidth;let s;s=t<=768?"mobile":t>768&&t<=1024?"tablet":"desktop";let o=document.querySelectorAll("style[rel='spress-inlined']").length,r=document.querySelectorAll('link[rel="stylesheet"][href]:not([data-spress-processed="true"])').length,n=new URL(window.location.href).hostname;if(Array.prototype.forEach.call(document.querySelectorAll('link[rel="stylesheet"][href]:not([data-spress-processed="true"])'),(function(e){new URL(e.href).hostname!==n&&r--})),"true"===e[s]){var i=JSON.parse(speed_css_vars.include_patterns);i=i.map((e=>new RegExp(e.replace(/\\\\/g,"\\"))));const e=new CSSUsageCollector(!1,i);0===o&&r>0&&e.collect_after_scroll(!1)}}();})();